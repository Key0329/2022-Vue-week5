import{M as D}from"./modal-1c749ba7.js";import{o as n,c as i,a as e,t as r,w as I,v as $,F as k,r as P,_ as T,b as f,d as u,e as v,f as U,n as q,g as y,h as C,i as E,p as S,j as A}from"./index-9aae2456.js";const L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"userProductModal"},N={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},H=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body text-start"},j={class:"row"},z={class:"col-sm-6"},X=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},K={key:0,class:"h5"},Q={key:1},W={class:"h6"},Y={class:"h5"},Z={class:"input-group"},ee=["value"];function te(t,s,d,x,o,m){return n(),i("div",L,[e("div",N,[e("div",O,[e("div",B,[e("h5",F,[e("span",null,r(d.tempProduct.title),1)]),H]),e("div",R,[e("div",j,[e("div",z,[e("img",{class:"img-fluid",src:d.tempProduct.imageUrl,alt:""},null,8,X)]),e("div",G,[e("span",J,r(d.tempProduct.category),1),e("p",null,"商品描述："+r(d.tempProduct.description),1),e("p",null,"商品內容："+r(d.tempProduct.content),1),d.tempProduct.price===d.tempProduct.origin_price?(n(),i("div",K,r(d.tempProduct.price)+" 元",1)):(n(),i("div",Q,[e("del",W,"原價 "+r(d.tempProduct.origin_price)+" 元",1),e("div",Y,"現在只要 "+r(d.tempProduct.price)+" 元",1)])),e("div",null,[e("div",Z,[I(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":s[0]||(s[0]=h=>o.qty=h)},[(n(),i(k,null,P(20,h=>e("option",{value:h,key:h},r(h),9,ee)),64))],512),[[$,o.qty]]),e("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=h=>d.addToCart(d.tempProduct.id,o.qty))},"加入購物車")])])])])])])])],512)}const se={props:{tempProduct:{type:Object,required:!0},addToCart:{type:Function}},data(){return{modal:{},qty:1}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}},mounted(){this.modal=new D(this.$refs.userProductModal)}},oe=T(se,[["render",te]]);const{VITE_URL:_,VITE_PATH:p}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week5/",MODE:"production",DEV:!1,PROD:!0},le={components:{UserProductModalComponent:oe},data(){return{products:[],product:{},tempProductId:"",cart:{},loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getProductsData(){this.$http.get(`${_}/api/${p}/products/all`).then(t=>{this.products=t.data.products}).catch(t=>{alert(t.response.data.message)})},getProductDetail(t){this.loadingItem=t,this.$http.get(`${_}/api/${p}/product/${t}`).then(s=>{this.product=s.data.product,this.loadingItem="",this.$refs.userProductModal.openModal()}).catch(s=>{alert(s.response.data.message)})},addToCart(t,s=1){const d={product_id:t,qty:s};this.loadingItem=t,this.$http.post(`${_}/api/${p}/cart`,{data:d}).then(()=>{this.getCartsData(),this.$refs.userProductModal.closeModal(),this.loadingItem="",alert("已加入購物車")}).catch(x=>{alert(x)})},getCartsData(){this.$http.get(`${_}/api/${p}/cart`).then(t=>{this.cart=t.data.data}).catch(t=>{alert(t.response.data.message)})},updateCartItem(t){const s={product_id:t.product.id,qty:t.qty};this.loadingItem=t.id,this.$http.put(`${_}/api/${p}/cart/${t.id}`,{data:s}).then(()=>{this.getCartsData(),this.loadingItem="",alert("已更新購物車")}).catch(d=>{alert(d.response.data.message)})},deleteCartItem(t){this.loadingItem=t.id,this.$http.delete(`${_}/api/${p}/cart/${t.id}`).then(()=>{this.getCartsData(),this.loadingItem="",alert("已刪除該筆訂單")}).catch(s=>{alert(s.response.data.message)})},deleteAllCart(){this.$http.delete(`${_}/api/${p}/carts`).then(()=>{this.getCartsData(),alert("已清空購物車")}).catch(t=>{alert(t.response.data.message)})},createOrder(){if(this.cart.carts.length===0){alert("購物車內無品項");return}const t=this.form;this.$http.post(`${_}/api/${p}/order`,{data:t}).then(s=>{alert(`${s.data.message}，訂單號碼為 ${s.data.orderId}`),this.getCartsData()}).catch(s=>{alert(s.response.data.message)}),this.$refs.form.resetForm(),this.form.message=""},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"請填入正確的手機號碼"}},mounted(){this.getProductsData(),this.getCartsData();const t=this.$loading.show();setTimeout(()=>{t.hide()},1e3)}},c=t=>(S("data-v-01bc4e1e"),t=t(),A(),t),ae={class:"container"},de={class:"mt-4"},ne={class:"table align-middle"},ie=c(()=>e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"商品名稱"),e("th",null,"價格"),e("th")])],-1)),re={style:{width:"200px"}},ce={key:0,class:"h5"},me={key:1},ue={class:"h6"},he={class:"h5"},_e={class:"btn-group btn-group-sm"},pe=["onClick"],be={key:0,class:"fas fa-spinner fa-pulse"},ge=["onClick"],fe={key:0,class:"fas fa-spinner fa-pulse"},ve={key:0},ye=c(()=>e("h5",null,"購物車內尚無商品",-1)),Ce=[ye],ke={key:1},Pe={class:"text-end"},xe={class:"table align-middle"},Ie=c(()=>e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價")])],-1)),Ve=["disabled","onClick"],Me={key:0,class:"fas fa-spinner fa-pulse"},$e={class:"input-group input-group-sm"},Te=["disabled","onUpdate:modelValue","onChange"],we=["value"],De={class:"text-end"},Ue=c(()=>e("small",{class:"text-success"},"折扣價：",-1)),qe=c(()=>e("td",{colspan:"3",class:"text-end"},"總計",-1)),Ee={class:"text-end"},Se=c(()=>e("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),Ae={class:"text-end text-success"},Le={class:"my-5 row justify-content-center"},Ne={class:"mb-3"},Oe=c(()=>e("label",{for:"email",class:"form-label"},"Email",-1)),Be={class:"mb-3"},Fe=c(()=>e("label",{for:"name",class:"form-label"},"收件人姓名",-1)),He={class:"mb-3"},Re=c(()=>e("label",{for:"tel",class:"form-label"},"收件人電話",-1)),je={class:"mb-3"},ze=c(()=>e("label",{for:"address",class:"form-label"},"收件人地址",-1)),Xe={class:"mb-3"},Ge=c(()=>e("label",{for:"message",class:"form-label"},"留言",-1)),Je={class:"text-end"},Ke=["disabled"];function Qe(t,s,d,x,o,m){var V,M;const h=f("UserProductModalComponent"),b=f("v-field"),g=f("error-message"),w=f("v-form");return n(),i("div",ae,[e("div",de,[u(h,{ref:"userProductModal",tempProduct:o.product,"add-to-cart":m.addToCart},null,8,["tempProduct","add-to-cart"]),e("table",ne,[ie,e("tbody",null,[(n(!0),i(k,null,P(o.products,l=>(n(),i("tr",{key:l.id},[e("td",re,[e("div",{class:"product-pic",style:q({backgroundImage:`url(${l.imageUrl})`}),alt:""},null,4)]),e("td",null,r(l.title),1),e("td",null,[l.price===l.origin_price?(n(),i("div",ce,r(l.price)+" 元 ",1)):(n(),i("div",me,[e("del",ue,"原價 "+r(l.origin_price)+" 元",1),e("div",he,"現在只要 "+r(l.price)+" 元",1)]))]),e("td",null,[e("div",_e,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:a=>m.getProductDetail(l.id)},[l.id===o.loadingItem?(n(),i("i",be)):v("",!0),y(" 查看更多 ")],8,pe),e("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>m.addToCart(l.id)},[l.id===o.loadingItem?(n(),i("i",fe)):v("",!0),y(" 加到購物車 ")],8,ge)])])]))),128))])]),(M=(V=o.cart)==null?void 0:V.carts)!=null&&M.length?(n(),i("div",ke,[e("div",Pe,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...l)=>m.deleteAllCart&&m.deleteAllCart(...l))}," 清空購物車 ")]),e("table",xe,[Ie,e("tbody",null,[o.cart.carts?(n(!0),i(k,{key:0},P(o.cart.carts,l=>(n(),i("tr",{key:l.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.id===o.loadingItem,onClick:a=>m.deleteCartItem(l)},[l.id===o.loadingItem?(n(),i("i",Me)):v("",!0),y(" x ")],8,Ve)]),e("td",null,r(l.product.title)+" ",1),e("td",null,[e("div",$e,[I(e("select",{name:"",id:"",class:"form-control",disabled:l.id===o.loadingItem,"onUpdate:modelValue":a=>l.qty=a,onChange:a=>m.updateCartItem(l)},[(n(),i(k,null,P(20,a=>e("option",{value:a,key:a},r(a),9,we)),64))],40,Te),[[$,l.qty]])])]),e("td",De,[Ue,y(" "+r(l.final_total),1)])]))),128)):v("",!0)]),e("tfoot",null,[e("tr",null,[qe,e("td",Ee,r(o.cart.total),1)]),e("tr",null,[Se,e("td",Ae,r(o.cart.final_total),1)])])])])):(n(),i("div",ve,Ce))]),e("div",Le,[u(w,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:U(({errors:l})=>[e("div",Ne,[Oe,u(b,{id:"email",name:"email",type:"email",class:C(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",modelValue:o.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=a=>o.form.user.email=a),rules:"email|required"},null,8,["modelValue","class"]),u(g,{name:"email",class:"invalid-feedback"})]),e("div",Be,[Fe,u(b,{id:"name",name:"姓名",type:"text",class:C(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",modelValue:o.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=a=>o.form.user.name=a),rules:"required"},null,8,["modelValue","class"]),u(g,{name:"姓名",class:"invalid-feedback"})]),e("div",He,[Re,u(b,{id:"tel",name:"電話",type:"tel",class:C(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",modelValue:o.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=a=>o.form.user.tel=a),rules:m.isPhone},null,8,["modelValue","class","rules"]),u(g,{name:"電話",class:"invalid-feedback"})]),e("div",je,[ze,u(b,{id:"address",name:"地址",type:"text",class:C(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",modelValue:o.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=a=>o.form.user.address=a),rules:"required"},null,8,["modelValue","class"]),u(g,{name:"地址",class:"invalid-feedback"})]),e("div",Xe,[Ge,I(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=a=>o.form.message=a)},null,512),[[E,o.form.message]])]),e("div",Je,[e("button",{type:"submit",class:"btn btn-danger",disabled:o.form.user.address===""||o.form.user.email===""||o.form.user.name===""||o.form.user.tel===""}," 送出訂單 ",8,Ke)])]),_:1},8,["onSubmit"])])])}const Ze=T(le,[["render",Qe],["__scopeId","data-v-01bc4e1e"]]);export{Ze as default};
