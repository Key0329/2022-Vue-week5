import{b as f,o as i,c as r,a as t,d as g,f as x,l as y,h as U,F as P,r as $,g as v,t as h,_ as k,e as b,w as u,i as m,m as N}from"./index-9552c0b6.js";import{M as I}from"./modal-ad5b34f3.js";const V={"aria-label":"Page navigation"},B={class:"pagination"},F={class:"page-item"},S=t("span",{"aria-hidden":"true"},"«",-1),H={class:"page-item"},G=t("span",{"aria-hidden":"true"},"»",-1);function A(l,e,a,c,o,d){const s=f("router-link");return i(),r("nav",V,[t("ul",B,[t("li",F,[g(s,{to:`/admin/products/${a.pages.current_page-1}`,onClick:e[0]||(e[0]=y(n=>d.changePage(a.pages.current_page-1,n),["prevent"])),class:U(["page-link",{disabled:!a.pages.has_pre}]),href:"#","aria-label":"Previous"},{default:x(()=>[S]),_:1},8,["to","class"])]),(i(!0),r(P,null,$(a.pages.total_pages,n=>(i(),r("li",{key:n+"page",class:U(["page-item",{"point-none":n===a.pages.current_page}])},[g(s,{to:"/admin/products/"+n,onClick:_=>d.changePage(n,_),class:"page-link"},{default:x(()=>[v(h(n),1)]),_:2},1032,["to","onClick"])],2))),128)),t("li",H,[g(s,{to:`/admin/products/${a.pages.current_page+1}`,onClick:e[1]||(e[1]=y(n=>d.changePage(a.pages.current_page+1,n),["prevent"])),class:U(["page-link",{disabled:!a.pages.has_next}]),"aria-label":"Next"},{default:x(()=>[G]),_:1},8,["to","class"])])])])}const L={name:"pagination-component",props:{pages:{type:Object,required:!0}},methods:{changePage(l,e){this.$emit("getProductsData",l,e)}}},O=k(L,[["render",A]]),T={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-xl"},j={class:"modal-content border-0"},z={class:"modal-header bg-dark text-white"},J={id:"productModalLabel",class:"modal-title"},K=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body text-start"},E={class:"row"},W={class:"col-sm-4"},Q=t("h3",{class:"mb-3"},"主要圖片",-1),X={class:"mb-3"},Y={class:"mb-3"},Z={key:0,class:"form-group mb-2"},tt=t("label",{class:"mb-2",for:"uploadImageFile"},"上傳圖片",-1),et=t("input",{id:"uploadImageFile",class:"form-control mb-1",type:"file",name:"file-to-upload"},null,-1),ot=t("input",{class:"form-control",type:"submit",value:"確認上傳"},null,-1),st=[tt,et,ot],lt={class:"form-group"},dt={key:0,for:"uploadImageUrl",class:"form-label"},at=["src"],it=t("h3",{class:"mb-3"},"多圖新增",-1),rt={key:0},nt={class:"mb-3"},ct=["onSubmit"],ut={key:0,class:"form-group mb-2"},pt=t("label",{class:"mb-2",for:"uploadImagesFile"},"上傳圖片",-1),mt=t("input",{id:"uploadImagesFile",class:"form-control mb-1",type:"file",name:"file-to-upload"},null,-1),ht=t("input",{class:"form-control",type:"submit",value:"確認上傳"},null,-1),_t=[pt,mt,ht],bt={class:"form-group"},gt={key:0,for:"uploadImagesUrl",class:"form-label"},ft=["onUpdate:modelValue"],vt=["src","alt"],yt={key:0},Pt={key:1},kt={key:1},xt={class:"col-sm-8"},Ut={class:"mb-3"},wt=t("label",{for:"title",class:"form-label"},"標題",-1),Mt={class:"row"},$t={class:"mb-3 col-md-6"},Ct=t("label",{for:"category",class:"form-label"},"分類",-1),It={class:"mb-3 col-md-6"},Dt=t("label",{for:"price",class:"form-label"},"單位",-1),Nt={class:"row"},Vt={class:"mb-3 col-md-6"},Bt=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Ft={class:"mb-3 col-md-6"},St=t("label",{for:"price",class:"form-label"},"售價",-1),Ht={class:"mb-3 col-md-6"},Gt=t("label",{for:"review",class:"form-label"},"評價",-1),At=t("hr",null,null,-1),Lt={class:"mb-3"},Ot=t("label",{for:"description",class:"form-label"},"產品描述",-1),Tt={class:"mb-3"},qt=t("label",{for:"content",class:"form-label"},"說明內容",-1),jt={class:"mb-3"},zt={class:"form-check"},Jt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Kt={class:"modal-footer"},Rt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Et(l,e,a,c,o,d){return i(),r("div",T,[t("div",q,[t("div",j,[t("div",z,[t("h5",J,[t("span",null,h(a.isNew?"新增產品":"編輯產品"),1)]),K]),t("div",R,[t("div",E,[t("div",W,[Q,t("div",X,[t("div",Y,[t("form",{class:"mt-2",onSubmit:e[1]||(e[1]=y(s=>d.handleSubmit("main","null",s),["prevent"])),action:"https://vue3-course-api.hexschool.io/v2/api/key0329/admin/upload",enctype:"multipart/form-data",method:"post"},[o.product.imageUrl?b("",!0):(i(),r("div",Z,st)),t("div",lt,[o.product.imageUrl?b("",!0):(i(),r("label",dt,"或輸入圖片網址")),u(t("input",{type:"text",id:"uploadImageUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[0]||(e[0]=s=>o.product.imageUrl=s)},null,512),[[m,o.product.imageUrl]])])],32)]),o.product.imageUrl?(i(),r("img",{key:0,class:"img-fluid",src:o.product.imageUrl,alt:"mainImg"},null,8,at)):b("",!0)]),it,Array.isArray(o.product.imagesUrl)?(i(),r("div",rt,[(i(!0),r(P,null,$(o.product.imagesUrl,(s,n)=>(i(),r("div",{class:"mb-4 pb-2 border-1 border-bottom",key:n},[t("div",nt,[t("form",{class:"mt-2",onSubmit:y(_=>d.handleSubmit("multi",n,_),["prevent"]),action:"https://vue3-course-api.hexschool.io/v2/api/key0329/admin/upload",enctype:"multipart/form-data",method:"post"},[o.product.imagesUrl[n]?b("",!0):(i(),r("div",ut,_t)),t("div",bt,[o.product.imagesUrl[n]?b("",!0):(i(),r("label",gt,"或輸入圖片網址")),u(t("input",{type:"text",id:"uploadImagesUrl",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":_=>o.product.imagesUrl[n]=_},null,8,ft),[[m,o.product.imagesUrl[n]]])])],40,ct)]),this.product.imagesUrl[n]?(i(),r("img",{key:0,class:"img-fluid",src:s,alt:"img"+n},null,8,vt)):b("",!0)]))),128)),!o.product.imagesUrl.length||o.product.imagesUrl[o.product.imagesUrl.length-1]?(i(),r("div",yt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=(...s)=>d.addImage&&d.addImage(...s))}," 新增圖片 ")])):(i(),r("div",Pt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=(...s)=>d.deleteImage&&d.deleteImage(...s))}," 刪除圖片 ")]))])):(i(),r("div",kt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[4]||(e[4]=(...s)=>d.createImage&&d.createImage(...s))}," 新增圖片 ")]))]),t("div",xt,[t("div",Ut,[wt,u(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[5]||(e[5]=s=>o.product.title=s)},null,512),[[m,o.product.title]])]),t("div",Mt,[t("div",$t,[Ct,u(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":e[6]||(e[6]=s=>o.product.category=s)},null,512),[[m,o.product.category]])]),t("div",It,[Dt,u(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":e[7]||(e[7]=s=>o.product.unit=s)},null,512),[[m,o.product.unit]])])]),t("div",Nt,[t("div",Vt,[Bt,u(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":e[8]||(e[8]=s=>o.product.origin_price=s)},null,512),[[m,o.product.origin_price,void 0,{number:!0}]])]),t("div",Ft,[St,u(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":e[9]||(e[9]=s=>o.product.price=s)},null,512),[[m,o.product.price,void 0,{number:!0}]])]),t("div",Ht,[Gt,u(t("input",{id:"review",type:"number",min:"0",max:"5",class:"form-control",placeholder:"請輸入星級","onUpdate:modelValue":e[10]||(e[10]=s=>o.product.review=s)},null,512),[[m,o.product.review,void 0,{number:!0}]])])]),At,t("div",Lt,[Ot,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":e[11]||(e[11]=s=>o.product.description=s),style:{height:"100px"}},null,512),[[m,o.product.description]])]),t("div",Tt,[qt,u(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":e[12]||(e[12]=s=>o.product.content=s),style:{height:"150px"}},null,512),[[m,o.product.content]])]),t("div",jt,[t("div",zt,[u(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[13]||(e[13]=s=>o.product.is_enabled=s)},null,512),[[N,o.product.is_enabled]]),Jt])])])])]),t("div",Kt,[Rt,t("button",{type:"button",class:"btn btn-primary",onClick:e[14]||(e[14]=(...s)=>d.updateProductHandler&&d.updateProductHandler(...s))}," 確認 ")])])])],512)}const w="https://vue3-course-api.hexschool.io/v2",M="key0329",Wt={name:"product-modal-component",props:{isNew:{type:Boolean,required:!0},tempProduct:{type:Object,required:!0}},data(){return{bsModal:"",product:{}}},methods:{openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},addImage(){this.product.imagesUrl.push("")},createImage(){this.product.imagesUrl=[],this.product.imagesUrl.push("")},deleteImage(){this.product.imagesUrl.pop()},updateImage(l,e){this.product.imagesUrl[l]=e},addNewProduct(){const l=this.product;if(!this.product.title||!this.product.category||!this.product.unit||!this.product.price||!this.product.origin_price){alert("標題 / 分類 / 單位 / 原價 / 售價 為必填欄位");return}this.$http.post(`${w}/api/${M}/admin/product`,{data:l}).then(e=>{alert(e.data.message),this.$emit("get-products-data"),this.closeModal()}).catch(e=>{alert(e.data.message)})},updateProduct(){const l=this.product,{id:e}=this.product;if(!this.product.title||!this.product.category||!this.product.unit||!this.product.price||!this.product.origin_price){alert("標題 / 分類 / 單位 / 原價 / 售價 為必填欄位");return}this.$http.put(`${w}/api/${M}/admin/product/${e}`,{data:l}).then(a=>{alert(a.data.message),this.$emit("get-products-data"),this.closeModal()}).catch(a=>{alert(a.data.message)})},updateProductHandler(){this.isNew?this.addNewProduct():this.updateProduct()},handleSubmit(l,e,a){const c=new FormData(a.target);this.sendFormData(l,e,c)},sendFormData(l,e,a){this.$http.post(`${w}/api/${M}/admin/upload`,a).then(c=>{const o=c.data.imageUrl;l==="multi"?this.product.imagesUrl[e]=o:l==="main"&&(this.product.imageUrl=o)}).catch(c=>{alert(c.message)})}},watch:{tempProduct:{handler(l){this.product=JSON.parse(JSON.stringify(l))},deep:!0}},mounted(){this.bsModal=new I(this.$refs.productModal)}},Qt=k(Wt,[["render",Et]]),Xt={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},Yt={class:"modal-dialog"},Zt={class:"modal-content border-0"},te=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ee={class:"modal-body"},oe={class:"text-danger"},se=t("br",null,null,-1),le={class:"modal-footer"},de=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ae(l,e,a,c,o,d){return i(),r("div",Xt,[t("div",Yt,[t("div",Zt,[te,t("div",ee,[v(" 是否刪除 "),t("strong",oe,h(o.product.title),1),v(" 商品"),se,v(" (刪除後將無法恢復)。 ")]),t("div",le,[de,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>d.deleteProduct&&d.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const ie="https://vue3-course-api.hexschool.io/v2",re="key0329",ne={name:"delete-product-modal-component",props:{tempProduct:{type:Object,required:!0}},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"key0329",bsModal:"",product:{}}},methods:{openModal(){this.bsModal.show()},closeModal(){this.bsModal.hide()},deleteProduct(){const{id:l}=this.product;this.$http.delete(`${ie}/api/${re}/admin/product/${l}`).then(e=>{alert(e.data.message),this.$emit("get-products-data"),this.closeModal()}).catch(e=>{alert(e.data.message)})}},watch:{tempProduct:{handler(l){this.product={...l}},deep:!0}},mounted(){this.bsModal=new I(this.$refs.delProductModal)}},ce=k(ne,[["render",ae]]),C="https://vue3-course-api.hexschool.io/v2",ue="key0329",pe={data(){return{products:[],tempProduct:{},isNew:!1,pages:{},rerenderKey:0}},components:{PaginationComponent:O,ProductModalComponent:Qt,DeleteProductModalComponent:ce},mounted(){const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexVueWeek3Token\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=l,this.checkAdmin()},methods:{checkAdmin(){this.$http.post(`${C}/api/user/check`).then(()=>{this.getProductsData()}).catch(()=>{alert("登入失敗"),this.$router.push("/login")})},getProductsData(l,e=1){const{id:a}=this.$route.params;let c=e;l||(c=a),this.$http.get(`${C}/api/${ue}/admin/products?page=${c}`).then(o=>{this.products=o.data.products,this.pages=o.data.pagination,this.forceRerender()}).catch(o=>{alert(o)})},modelHandler(l,e){l==="createBtn"?(this.isNew=!0,this.tempProduct={},this.$refs.productModal.openModal()):l==="editBtn"?(this.tempProduct={...e},this.isNew=!1,this.$refs.productModal.openModal()):l==="deleteBtn"&&(this.tempProduct={...e},this.$refs.delProductModal.openModal())},forceRerender(){this.rerenderKey+=1}}},me={class:"container"},he={class:"text-end mt-4"},_e={class:"table mt-4"},be=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"評價星級"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1),ge={class:"text-start"},fe={class:"text-start"},ve={class:"text-center"},ye={key:0,class:"text-success"},Pe={key:1},ke={class:"btn-group"},xe=["onClick"],Ue=["onClick"];function we(l,e,a,c,o,d){const s=f("pagination-component"),n=f("product-modal-component"),_=f("delete-product-modal-component");return i(),r(P,null,[t("div",me,[t("div",he,[t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=p=>d.modelHandler("createBtn"))}," 建立新的產品 ")]),t("table",_e,[be,t("tbody",null,[(i(!0),r(P,null,$(o.products,p=>(i(),r("tr",{key:p.id},[t("td",null,h(p.category),1),t("td",null,h(p.title),1),t("td",ge,"NT$ "+h(p.origin_price),1),t("td",fe,"NT$ "+h(p.price),1),t("td",ve,h(p.review),1),t("td",null,[p.is_enabled?(i(),r("span",ye,"啟用")):(i(),r("span",Pe,"未啟用"))]),t("td",null,[t("div",ke,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:D=>d.modelHandler("editBtn",p)}," 編輯 ",8,xe),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:D=>d.modelHandler("deleteBtn",p)}," 刪除 ",8,Ue)])])]))),128))])]),g(s,{pages:o.pages,onGetProductsData:d.getProductsData},null,8,["pages","onGetProductsData"])]),g(n,{ref:"productModal","is-new":o.isNew,"temp-product":o.tempProduct,onGetProductsData:d.getProductsData},null,8,["is-new","temp-product","onGetProductsData"]),g(_,{ref:"delProductModal","temp-product":o.tempProduct,onGetProductsData:d.getProductsData},null,8,["temp-product","onGetProductsData"])],64)}const Ce=k(pe,[["render",we]]);export{Ce as default};
