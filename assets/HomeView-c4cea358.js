import{M as D}from"./modal-9a4b65b0.js";import{o as n,c as i,a as t,t as r,w as I,v as $,F as P,r as k,_ as T,b as g,d as u,e as v,f as U,n as q,g as y,h as C,i as E,p as S,j as A}from"./index-106748da.js";const L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"userProductModal"},N={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},F={class:"modal-title",id:"exampleModalLabel"},H=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body text-start"},j={class:"row"},z={class:"col-sm-6"},X=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},K={key:0,class:"h5"},Q={key:1},W={class:"h6"},Y={class:"h5"},Z={class:"input-group"},tt=["value"];function et(e,s,d,x,o,m){return n(),i("div",L,[t("div",N,[t("div",O,[t("div",B,[t("h5",F,[t("span",null,r(d.tempProduct.title),1)]),H]),t("div",R,[t("div",j,[t("div",z,[t("img",{class:"img-fluid",src:d.tempProduct.imageUrl,alt:""},null,8,X)]),t("div",G,[t("span",J,r(d.tempProduct.category),1),t("p",null,"商品描述："+r(d.tempProduct.description),1),t("p",null,"商品內容："+r(d.tempProduct.content),1),d.tempProduct.price===d.tempProduct.origin_price?(n(),i("div",K,r(d.tempProduct.price)+" 元",1)):(n(),i("div",Q,[t("del",W,"原價 "+r(d.tempProduct.origin_price)+" 元",1),t("div",Y,"現在只要 "+r(d.tempProduct.price)+" 元",1)])),t("div",null,[t("div",Z,[I(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":s[0]||(s[0]=h=>o.qty=h)},[(n(),i(P,null,k(20,h=>t("option",{value:h,key:h},r(h),9,tt)),64))],512),[[$,o.qty]]),t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=h=>d.addToCart(d.tempProduct.id,o.qty))},"加入購物車")])])])])])])])],512)}const st={props:{tempProduct:{type:Object,required:!0},addToCart:{type:Function}},data(){return{modal:{},qty:1}},methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}},mounted(){this.modal=new D(this.$refs.userProductModal)}},ot=T(st,[["render",et]]);const{VITE_URL:_,VITE_PATH:p}={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"key0329",VITE_TEXT:"這是產品的環境",BASE_URL:"/2022-Vue-week5/",MODE:"production",DEV:!1,PROD:!0},lt={components:{UserProductModalComponent:ot},data(){return{products:[],product:{},tempProductId:"",cart:{},loadingItem:"",form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getProductsData(){this.$http.get(`${_}/api/${p}/products/all`).then(e=>{this.products=e.data.products}).catch(e=>{alert(e.response.data.message)})},getProductDetail(e){this.loadingItem=e,this.$http.get(`${_}/api/${p}/product/${e}`).then(s=>{this.product=s.data.product,this.loadingItem="",this.$refs.userProductModal.openModal()}).catch(s=>{alert(s.response.data.message)})},addToCart(e,s=1){const d={product_id:e,qty:s};this.loadingItem=e,this.$http.post(`${_}/api/${p}/cart`,{data:d}).then(()=>{this.getCartsData(),this.$refs.userProductModal.closeModal(),this.$refs.userProductModal.qty=1,this.loadingItem="",alert("已加入購物車")}).catch(x=>{alert(x)})},getCartsData(){this.$http.get(`${_}/api/${p}/cart`).then(e=>{this.cart=e.data.data}).catch(e=>{alert(e.response.data.message)})},updateCartItem(e){const s={product_id:e.product.id,qty:e.qty};this.loadingItem=e.id,this.$http.put(`${_}/api/${p}/cart/${e.id}`,{data:s}).then(()=>{this.getCartsData(),this.loadingItem="",alert("已更新購物車")}).catch(d=>{alert(d.response.data.message)})},deleteCartItem(e){this.loadingItem=e.id,this.$http.delete(`${_}/api/${p}/cart/${e.id}`).then(()=>{this.getCartsData(),this.loadingItem="",alert("已刪除該筆訂單")}).catch(s=>{alert(s.response.data.message)})},deleteAllCart(){this.$http.delete(`${_}/api/${p}/carts`).then(()=>{this.getCartsData(),alert("已清空購物車")}).catch(e=>{alert(e.response.data.message)})},createOrder(){if(this.cart.carts.length===0){alert("購物車內無品項");return}const e=this.form;this.$http.post(`${_}/api/${p}/order`,{data:e}).then(s=>{alert(`${s.data.message}，訂單號碼為 ${s.data.orderId}`),this.getCartsData()}).catch(s=>{alert(s.response.data.message)}),this.$refs.form.resetForm(),this.form.message=""},isPhone(e){return/^(09)[0-9]{8}$/.test(e)?!0:"請填入 09 為開頭的十位數手機號碼"}},mounted(){this.getProductsData(),this.getCartsData();const e=this.$loading.show();setTimeout(()=>{e.hide()},1e3)}},c=e=>(S("data-v-f90cc002"),e=e(),A(),e),at={class:"container"},dt={class:"mt-4"},nt={class:"table align-middle"},it=c(()=>t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1)),rt={style:{width:"200px"}},ct={key:0,class:"h5"},mt={key:1},ut={class:"h6"},ht={class:"h5"},_t={class:"btn-group btn-group-sm"},pt=["onClick"],ft={key:0,class:"fas fa-spinner fa-pulse"},bt=["onClick"],gt={key:0,class:"fas fa-spinner fa-pulse"},vt={key:0},yt=c(()=>t("h5",null,"購物車內尚無商品",-1)),Ct=[yt],Pt={key:1},kt={class:"text-end"},xt={class:"table align-middle"},It=c(()=>t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",null,"單價")])],-1)),Vt=["disabled","onClick"],Mt={key:0,class:"fas fa-spinner fa-pulse"},$t={class:"input-group input-group-sm"},Tt=["disabled","onUpdate:modelValue","onChange"],wt=["value"],Dt={class:"text-end"},Ut=c(()=>t("small",{class:"text-success"},"折扣價：",-1)),qt=c(()=>t("td",{colspan:"3",class:"text-end"},"總計",-1)),Et={class:"text-end"},St=c(()=>t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1)),At={class:"text-end text-success"},Lt={class:"my-5 row justify-content-center text-start"},Nt={class:"mb-3"},Ot=c(()=>t("label",{for:"email",class:"form-label"},"Email",-1)),Bt={class:"mb-3"},Ft=c(()=>t("label",{for:"name",class:"form-label"},"收件人姓名",-1)),Ht={class:"mb-3"},Rt=c(()=>t("label",{for:"tel",class:"form-label"},"收件人電話",-1)),jt={class:"mb-3"},zt=c(()=>t("label",{for:"address",class:"form-label"},"收件人地址",-1)),Xt={class:"mb-3"},Gt=c(()=>t("label",{for:"message",class:"form-label"},"留言",-1)),Jt={class:"text-end"},Kt=["disabled"];function Qt(e,s,d,x,o,m){var V,M;const h=g("UserProductModalComponent"),f=g("v-field"),b=g("error-message"),w=g("v-form");return n(),i("div",at,[t("div",dt,[u(h,{ref:"userProductModal",tempProduct:o.product,"add-to-cart":m.addToCart},null,8,["tempProduct","add-to-cart"]),t("table",nt,[it,t("tbody",null,[(n(!0),i(P,null,k(o.products,l=>(n(),i("tr",{key:l.id},[t("td",rt,[t("div",{class:"product-pic",style:q({backgroundImage:`url(${l.imageUrl})`}),alt:""},null,4)]),t("td",null,r(l.title),1),t("td",null,[l.price===l.origin_price?(n(),i("div",ct,r(l.price)+" 元 ",1)):(n(),i("div",mt,[t("del",ut,"原價 "+r(l.origin_price)+" 元",1),t("div",ht,"現在只要 "+r(l.price)+" 元",1)]))]),t("td",null,[t("div",_t,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:a=>m.getProductDetail(l.id)},[l.id===o.loadingItem?(n(),i("i",ft)):v("",!0),y(" 查看更多 ")],8,pt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:a=>m.addToCart(l.id)},[l.id===o.loadingItem?(n(),i("i",gt)):v("",!0),y(" 加到購物車 ")],8,bt)])])]))),128))])]),(M=(V=o.cart)==null?void 0:V.carts)!=null&&M.length?(n(),i("div",Pt,[t("div",kt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...l)=>m.deleteAllCart&&m.deleteAllCart(...l))}," 清空購物車 ")]),t("table",xt,[It,t("tbody",null,[o.cart.carts?(n(!0),i(P,{key:0},k(o.cart.carts,l=>(n(),i("tr",{key:l.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",disabled:l.id===o.loadingItem,onClick:a=>m.deleteCartItem(l)},[l.id===o.loadingItem?(n(),i("i",Mt)):v("",!0),y(" x ")],8,Vt)]),t("td",null,r(l.product.title)+" ",1),t("td",null,[t("div",$t,[I(t("select",{name:"",id:"",class:"form-control",disabled:l.id===o.loadingItem,"onUpdate:modelValue":a=>l.qty=a,onChange:a=>m.updateCartItem(l)},[(n(),i(P,null,k(20,a=>t("option",{value:a,key:a},r(a),9,wt)),64))],40,Tt),[[$,l.qty]])])]),t("td",Dt,[Ut,y(" "+r(l.final_total),1)])]))),128)):v("",!0)]),t("tfoot",null,[t("tr",null,[qt,t("td",Et,r(o.cart.total),1)]),t("tr",null,[St,t("td",At,r(o.cart.final_total),1)])])])])):(n(),i("div",vt,Ct))]),t("div",Lt,[u(w,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:U(({errors:l})=>[t("div",Nt,[Ot,u(f,{id:"email",name:"email",type:"email",class:C(["form-control",{"is-invalid":l.email}]),placeholder:"請輸入 Email",modelValue:o.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=a=>o.form.user.email=a),rules:"email|required"},null,8,["modelValue","class"]),u(b,{name:"email",class:"invalid-feedback"})]),t("div",Bt,[Ft,u(f,{id:"name",name:"姓名",type:"text",class:C(["form-control",{"is-invalid":l.姓名}]),placeholder:"請輸入姓名",modelValue:o.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=a=>o.form.user.name=a),rules:"required"},null,8,["modelValue","class"]),u(b,{name:"姓名",class:"invalid-feedback"})]),t("div",Ht,[Rt,u(f,{id:"tel",name:"電話",type:"tel",class:C(["form-control",{"is-invalid":l.電話}]),placeholder:"請輸入電話",modelValue:o.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=a=>o.form.user.tel=a),rules:m.isPhone},null,8,["modelValue","class","rules"]),u(b,{name:"電話",class:"invalid-feedback"})]),t("div",jt,[zt,u(f,{id:"address",name:"地址",type:"text",class:C(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入地址",modelValue:o.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=a=>o.form.user.address=a),rules:"required"},null,8,["modelValue","class"]),u(b,{name:"地址",class:"invalid-feedback"})]),t("div",Xt,[Gt,I(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=a=>o.form.message=a)},null,512),[[E,o.form.message]])]),t("div",Jt,[t("button",{type:"submit",class:"btn btn-danger",disabled:o.form.user.address===""||o.form.user.email===""||o.form.user.name===""||o.form.user.tel===""}," 送出訂單 ",8,Kt)])]),_:1},8,["onSubmit"])])])}const Zt=T(lt,[["render",Qt],["__scopeId","data-v-f90cc002"]]);export{Zt as default};
